#!/bin/bash
host=$1
base=$2
folder=$3

dow=`date +%u`  	# вычисляем день недели
if test $dow -eq 7	# а не пора ли делать недельную копию?
then
w=$(($(date +%W) % 4))	# 4-недельная нумерация

fn="_w$w"
else
fn="_d$dow"
fi

d=`date +%d` 		# Ежемесячная копия
if test $d -eq 01
then
m=`date +%m`
fn="_m$m"
fi

zipname="$folder/$base/$base$fn.zip"

gbak -b $host:$base  $folder/$base/$base.fbk 
zip -m -j $zipname $folder/$base/$base.fbk	# архивируем полученный бекап
